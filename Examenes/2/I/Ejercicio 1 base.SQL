CREATE DATABASE PARCIAL2_EJ1

USE PARCIAL2_EJ1

CREATE TABLE MARCAS(
	IDMARCA BIGINT NOT NULL PRIMARY KEY,
	MARCA VARCHAR(50) NOT NULL
)
GO
CREATE TABLE CATEGORIAS(
	IDCATEGORIA BIGINT NOT NULL PRIMARY KEY,
	CATEGORIA VARCHAR(50) NOT NULL
)
GO
CREATE TABLE ARTICULOS(
	IDARTICULO BIGINT NOT NULL PRIMARY KEY,
	ARTICULO VARCHAR(50) NOT NULL,
	STOCK INT NOT NULL CHECK (STOCK > 0),
	PRECIO SMALLMONEY NOT NULL,
	IDMARCA BIGINT NOT NULL FOREIGN KEY REFERENCES MARCAS(IDMARCA),
	IDCATEGORIA BIGINT NOT NULL FOREIGN KEY REFERENCES CATEGORIAS(IDCATEGORIA)
)
GO
-- LA VENTA DE MANERA GENERAL, NO CONTIENE EL DETALLE DE LA VENTA
CREATE TABLE VENTAS(
	IDVENTA BIGINT NOT NULL PRIMARY KEY IDENTITY (1, 1),
	FECHAHORA SMALLDATETIME NOT NULL DEFAULT(GETDATE()),
	FORMAPAGO CHAR CHECK(FORMAPAGO = 'E' OR FORMAPAGO = 'T'),
	IMPORTE SMALLMONEY NOT NULL --CAMPO CALCULABLE PERO COMPLEJO DE CALCULAR (DENORMALIZACIÓN ACEPTABLE)
)
GO
-- EL DETALLE DE CADA UNO DE LOS ARTICULOS DE UNA VENTA
CREATE TABLE DETALLE_VENTA(
	IDVENTA BIGINT NOT NULL FOREIGN KEY REFERENCES VENTAS (IDVENTA),
	IDARTICULO BIGINT NOT NULL FOREIGN KEY REFERENCES ARTICULOS (IDARTICULO),
	CANTIDAD INT NOT NULL,
	PRECIO SMALLMONEY NOT NULL, --COMO EL PRECIO DEL ARTÍCULO PUEDE VARIAR ES NECESARIO ALMACENAR EL VALOR DEL MISMO A LA FECHA DE LA VENTA (DENORMALIZACIÓN ACEPTABLE)
	PRIMARY KEY (IDVENTA, IDARTICULO)
)
